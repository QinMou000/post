<p id="main-toc"><strong>目录</strong></p> <br><p id="%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C%EF%BC%9A" rel="nofollow">最终实现效果：</a></p> <br><p id="%C2%A0%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%C2%A0%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9A" rel="nofollow">实现基本的功能：</a></p> <br><p id="%E6%A0%B9%E6%8D%AE%E6%B8%B8%E6%88%8F%E8%BF%9B%E7%A8%8B%E8%A7%A3%E9%87%8A%E4%BB%A3%E7%A0%81%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E6%A0%B9%E6%8D%AE%E6%B8%B8%E6%88%8F%E8%BF%9B%E7%A8%8B%E8%A7%A3%E9%87%8A%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow">根据游戏进程解释代码：</a></p> <br><p id="%E6%B8%B8%E6%88%8F%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E6%B8%B8%E6%88%8F%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9A" rel="nofollow">游戏初始化：</a></p> <br><p id="%E9%A6%96%E5%85%88%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E5%B0%86%E7%AA%97%E5%8F%A3%E5%90%8D%E7%A7%B0%E6%94%B9%E4%B8%BA%20%E2%80%9C%E8%B4%AA%E5%90%83%E8%9B%87%E2%80%9D%20%E5%B9%B6%E5%B0%86%E5%85%89%E6%A0%87%E9%9A%90%E8%97%8F%E6%8E%89%E3%80%82%E5%86%8D%E5%9C%A8%E4%B8%AD%E9%97%B4%E6%89%93%E5%8D%B0%E6%B8%B8%E6%88%8F%E4%BF%A1%E6%81%AF%E3%80%82-toc" style="margin-left:80px;"><a href="#%E9%A6%96%E5%85%88%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E5%B0%86%E7%AA%97%E5%8F%A3%E5%90%8D%E7%A7%B0%E6%94%B9%E4%B8%BA%20%E2%80%9C%E8%B4%AA%E5%90%83%E8%9B%87%E2%80%9D%20%E5%B9%B6%E5%B0%86%E5%85%89%E6%A0%87%E9%9A%90%E8%97%8F%E6%8E%89%E3%80%82%E5%86%8D%E5%9C%A8%E4%B8%AD%E9%97%B4%E6%89%93%E5%8D%B0%E6%B8%B8%E6%88%8F%E4%BF%A1%E6%81%AF%E3%80%82" rel="nofollow">首先进入游戏，我们应该将窗口名称改为 “贪吃蛇” 并将光标隐藏掉。再在中间打印游戏信息。</a></p> <br><p id="%C2%A0%E4%B9%8B%E5%90%8E%E6%88%91%E4%BB%AC%E8%A6%81%E6%8A%8A%E5%9C%B0%E5%9B%BE%E6%89%93%E5%8D%B0%E5%87%BA%E6%9D%A5%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%E4%B9%8B%E5%90%8E%E6%88%91%E4%BB%AC%E8%A6%81%E6%8A%8A%E5%9C%B0%E5%9B%BE%E6%89%93%E5%8D%B0%E5%87%BA%E6%9D%A5%EF%BC%9A" rel="nofollow"> 之后我们要把地图打印出来：</a></p> <br><p id="%E7%84%B6%E5%90%8E%E6%88%91%E4%BB%AC%E5%B0%86%E8%B4%AA%E5%90%83%E8%9B%87%E5%88%9B%E5%BB%BA%E5%87%BA%E6%9D%A5%EF%BC%8C%E5%B0%86%E8%9B%87%E6%9C%89%E5%85%B3%E7%9A%84%E4%BF%A1%E6%81%AF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%B0%81%E8%A3%85%E8%B5%B7%E6%9D%A5%EF%BC%8C%E5%B0%86%E8%9B%87%E8%BA%AB%E7%94%A8%E9%93%BE%E8%A1%A8%E7%BB%B4%E6%8A%A4%E3%80%82-toc" style="margin-left:80px;"><a href="#%E7%84%B6%E5%90%8E%E6%88%91%E4%BB%AC%E5%B0%86%E8%B4%AA%E5%90%83%E8%9B%87%E5%88%9B%E5%BB%BA%E5%87%BA%E6%9D%A5%EF%BC%8C%E5%B0%86%E8%9B%87%E6%9C%89%E5%85%B3%E7%9A%84%E4%BF%A1%E6%81%AF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%B0%81%E8%A3%85%E8%B5%B7%E6%9D%A5%EF%BC%8C%E5%B0%86%E8%9B%87%E8%BA%AB%E7%94%A8%E9%93%BE%E8%A1%A8%E7%BB%B4%E6%8A%A4%E3%80%82" rel="nofollow">然后我们将贪吃蛇创建出来，将蛇有关的信息用结构体和枚举类型封装起来，将蛇身用链表维护。</a></p> <br><p id="%E5%88%9B%E5%BB%BA%E9%A3%9F%E7%89%A9-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E9%A3%9F%E7%89%A9" rel="nofollow">创建食物</a></p> <br><p id="%C2%A0%E6%B8%B8%E6%88%8F%E5%BC%80%E5%A7%8B%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%C2%A0%E6%B8%B8%E6%88%8F%E5%BC%80%E5%A7%8B%EF%BC%9A" rel="nofollow"> 游戏开始：</a></p> <br><p id="%E7%94%A8dowhile%E5%BE%AA%E7%8E%AF%E5%AF%B9%E4%B8%BB%E4%BD%93%E8%BF%9B%E8%A1%8C%E4%B8%8D%E6%96%AD%E5%88%B7%E6%96%B0-toc" style="margin-left:80px;"><a href="#%E7%94%A8dowhile%E5%BE%AA%E7%8E%AF%E5%AF%B9%E4%B8%BB%E4%BD%93%E8%BF%9B%E8%A1%8C%E4%B8%8D%E6%96%AD%E5%88%B7%E6%96%B0" rel="nofollow">用dowhile循环对主体进行不断刷新</a></p> <br><p id="%E6%89%93%E5%8D%B0%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF-toc" style="margin-left:80px;"><a href="#%E6%89%93%E5%8D%B0%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF" rel="nofollow">打印相关信息</a></p> <br><p id="%E6%8C%89%E9%94%AE%E6%A3%80%E6%B5%8B-toc" style="margin-left:80px;"><a href="#%E6%8C%89%E9%94%AE%E6%A3%80%E6%B5%8B" rel="nofollow">按键检测</a></p> <br><p id="%E8%9B%87%E7%9A%84%E7%A7%BB%E5%8A%A8-toc" style="margin-left:80px;"><a href="#%E8%9B%87%E7%9A%84%E7%A7%BB%E5%8A%A8" rel="nofollow">蛇的移动</a></p> <br><p id="%E5%88%A4%E6%96%AD%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E4%B8%BA%E9%A3%9F%E7%89%A9%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%E5%88%A4%E6%96%AD%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E4%B8%BA%E9%A3%9F%E7%89%A9%EF%BC%9A" rel="nofollow">判断下一位置是否为食物：</a></p> <br><p id="%C2%A0%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E6%98%AF%E9%A3%9F%E7%89%A9%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%C2%A0%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E6%98%AF%E9%A3%9F%E7%89%A9%EF%BC%9A" rel="nofollow"> 下一位置是食物：</a></p> <br><p id="%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E4%B8%8D%E6%98%AF%E9%A3%9F%E7%89%A9%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E4%B8%8D%E6%98%AF%E9%A3%9F%E7%89%A9%EF%BC%9A" rel="nofollow">下一位置不是食物：</a></p> <br><p id="%C2%A0%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%92%9E%E5%A2%99%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%C2%A0%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%92%9E%E5%A2%99%EF%BC%9A" rel="nofollow"> 检测是否撞墙：</a></p> <br><p id="%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%92%9E%E5%88%B0%E8%87%AA%E5%B7%B1%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%92%9E%E5%88%B0%E8%87%AA%E5%B7%B1%EF%BC%9A" rel="nofollow">检测是否撞到自己：</a></p> <br><p id="%C2%A0%E8%9B%87%E7%A7%BB%E5%8A%A8%E4%B8%80%E6%AD%A5%E7%9A%84%E6%80%BB%E5%87%BD%E6%95%B0%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%C2%A0%E8%9B%87%E7%A7%BB%E5%8A%A8%E4%B8%80%E6%AD%A5%E7%9A%84%E6%80%BB%E5%87%BD%E6%95%B0%EF%BC%9A" rel="nofollow"> 蛇移动一步的总函数：</a></p> <br><p id="%C2%A0%E6%B8%B8%E6%88%8F%E7%BB%93%E6%9D%9F%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%C2%A0%E6%B8%B8%E6%88%8F%E7%BB%93%E6%9D%9F%EF%BC%9A" rel="nofollow"> 游戏结束：</a></p> <br><p id="%E5%90%8E%E7%BB%AD%E6%94%B9%E8%BF%9B%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%90%8E%E7%BB%AD%E6%94%B9%E8%BF%9B%EF%BC%9A" rel="nofollow">后续改进：</a></p> <br><hr id="hr-toc" /> <br><p></p> <br><blockquote> <br> <p><img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6f2b920cd38b273e9349974209147fee.png" /></p> <br> <p style="text-align:center;">✨✨所属专栏：<a href="https://blog.csdn.net/2301_80194476/category_12649617.html" title="C语言">C语言</a>✨✨</p> <br> <p style="text-align:center;">✨✨作者主页：<a href="https://blog.csdn.net/2301_80194476?spm=1000.2115.3001.5343" title="嶔某">嶔某</a>✨✨</p> <br></blockquote> <br><p id="main-toc"><span style="color:#fe2c24;"><strong>游戏源代码链接：</strong></span><a href="https://gitee.com/wang-qin928/c-language-learning/tree/master/function/%E8%B4%AA%E5%90%83%E8%9B%87" rel="nofollow" title="function/贪吃蛇 · 钦某/c-language-learning - 码云 - 开源中国 (gitee.com)">function/贪吃蛇 · 钦某/c-language-learning - 码云 - 开源中国 (gitee.com)</a></p> <br><p id="%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C%EF%BC%9A-toc" style="margin-left:0px;"></p> <br><h2 id="%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C%EF%BC%9A">最终实现效果：</h2> <br><p><img alt="" height="216" src="https://i-blog.csdnimg.cn/blog_migrate/37d38962ae73ea1debcd457b73f372a1.png" width="340" /><img alt="" height="216" src="https://i-blog.csdnimg.cn/blog_migrate/e923ff53c41a5f1f4d6a2e0b5027214d.jpeg" width="341" /></p> <br><h2 id="%C2%A0%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9A">实现基本的功能：</h2> <br><pre><code class="language-cpp">void set_pos(short x, short y);//定位光标位置<br><br>void Game_Start(pSnake ps);//初始化<br><br>void WelcomeToGame(void);//打印欢迎界面<br><br>void CreateMap(void);//创建地图<br><br>void InitSnake(pSnake ps);//初始化蛇身<br><br>void CreateFood(pSnake ps);//创建食物<br><br>void Game_Run(pSnake ps);//游戏运行逻辑<br><br>void SnakeMove(pSnake ps);//蛇的移动<br><br>bool NextIsFood(pSnakeNode pn,pSnake ps);//判断下一位置是否为食物<br><br>void EatFood(pSnakeNode pn, pSnake ps);//吃掉食物<br><br>void NoFood(pSnakeNode pn, pSnake ps);//下一个位置不是食物<br><br>void KillByWall(pSnake ps);//检测撞墙<br><br>void KillBySelf(pSnake ps);//检测撞自己<br><br>void Game_End(pSnake ps);//游戏善后</code></pre> <br><p>• 贪吃蛇地图绘制<br /> • 蛇吃⻝物的功能（上、下、左、右⽅向键控制蛇的动作）<br /> • 蛇撞墙死亡<br /> • 蛇撞⾃⾝死亡<br /> • 计算得分<br /> • 蛇⾝加速、减速<br /> • 暂停游戏</p> <br><p>运用到的知识：C语⾔函数、枚举、结构体、动态内存管理、预处理指令、链表、Win32API等</p> <br><h2 id="%E6%A0%B9%E6%8D%AE%E6%B8%B8%E6%88%8F%E8%BF%9B%E7%A8%8B%E8%A7%A3%E9%87%8A%E4%BB%A3%E7%A0%81%EF%BC%9A">根据游戏进程解释代码：</h2> <br><p id="%E8%BF%99%E9%87%8C%E5%88%86%E4%B8%BA%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%B8%AA%E5%87%BD%E6%95%B0%E5%AF%B9%E6%B8%B8%E6%88%8F%E8%BF%9B%E8%A1%8C%E5%AE%9E%E7%8E%B0%EF%BC%9A">这里分为下面几个函数对游戏进行实现：</p> <br><pre><code class="language-cpp">system("cls");<br>//创建贪吃蛇<br>pSnakeNode pSnake = NULL;<br><br>Snake snake = { 0 };<br><br>//初始化游戏<br>Game_Start(&snake);<br><br>//运行游戏<br>Game_Run(&snake);<br><br>结束游戏<br>Game_End(&snake);</code></pre> <br><h3 id="%E6%B8%B8%E6%88%8F%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9A">游戏初始化：</h3> <br><pre><code class="language-cpp">void Game_Start(pSnake ps)//初始化<br>{<br>	//0.设置窗口大小/名字<br>	system("mode con cols=100 lines=30");<br>	system("title 贪吃蛇");<br><br>	//1.隐藏光标<br>	HANDLE houtput = GetStdHandle(STD_OUTPUT_HANDLE);<br>	CONSOLE_CURSOR_INFO CursorInfo;<br>	GetConsoleCursorInfo(houtput,&CursorInfo);<br>	CursorInfo.bVisible = false;<br>	SetConsoleCursorInfo(houtput,&CursorInfo);<br>	<br>	//2.打印欢迎界面,介绍功能<br>	WelcomeToGame();<br><br>	//3.绘制地图<br>	CreateMap();<br><br>	//4.创建蛇<br>	InitSnake(ps);<br><br>	//5.创建食物<br>	CreateFood(ps);<br>}</code></pre> <br><h4 id="%E9%A6%96%E5%85%88%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E5%B0%86%E7%AA%97%E5%8F%A3%E5%90%8D%E7%A7%B0%E6%94%B9%E4%B8%BA%20%E2%80%9C%E8%B4%AA%E5%90%83%E8%9B%87%E2%80%9D%20%E5%B9%B6%E5%B0%86%E5%85%89%E6%A0%87%E9%9A%90%E8%97%8F%E6%8E%89%E3%80%82%E5%86%8D%E5%9C%A8%E4%B8%AD%E9%97%B4%E6%89%93%E5%8D%B0%E6%B8%B8%E6%88%8F%E4%BF%A1%E6%81%AF%E3%80%82">首先进入游戏，我们应该将窗口名称改为 “贪吃蛇” 并将光标隐藏掉。再在中间打印游戏信息。</h4> <br><p>这里用到的函数有：</p> <br><p>（1）system("mode con cols=100 lines=30");</p> <br><p>将窗口设置为100列，30行</p> <br><p>（2）system("title 贪吃蛇");</p> <br><p>将title设置为贪吃蛇</p> <br><p>（3）system("pause");</p> <br><p>暂停程序，按下任意键继续</p> <br><p>（4）system("cls");</p> <br><p>清理屏幕</p> <br><pre><code class="language-cpp">/*******************************************/<br>//0.设置窗口大小/名字<br>system("mode con cols=100 lines=30");<br>system("title 贪吃蛇");<br>/*******************************************/<br>void set_pos(short x, short y)<br>{<br>	//获得标准输出设备的句柄<br>	HANDLE houtput = NULL; <br>	houtput = GetStdHandle(STD_OUTPUT_HANDLE);<br><br>	//定位光标的位置<br>	COORD pos = { x,y };<br>	SetConsoleCursorPosition(houtput,pos);<br>}<br>/*******************************************/<br>void WelcomeToGame()<br>{<br>	set_pos(40, 12);<br>	wprintf(L"欢迎来到贪吃蛇小游戏");<br>	set_pos(42,18);<br>	system("pause");<br>	system("cls");<br>	set_pos(30, 12);<br>	wprintf(L"用上下左右控制蛇的移动，按 {[ 加速, ]} 减速\n");<br>	set_pos(38, 13);<br>	wprintf(L"加速可以得到更高的分数\n");<br>	set_pos(42, 18);<br>	system("pause");<br>	system("cls");<br>}<br>/********************************************/</code></pre> <br><h4 id="%C2%A0%E4%B9%8B%E5%90%8E%E6%88%91%E4%BB%AC%E8%A6%81%E6%8A%8A%E5%9C%B0%E5%9B%BE%E6%89%93%E5%8D%B0%E5%87%BA%E6%9D%A5%EF%BC%9A"> 之后我们要把地图打印出来：</h4> <br><p>分别打印上下左右的墙，将墙宏定义为WALL，字符为’□‘</p> <br><pre><code class="language-cpp">void CreateMap()<br>{<br>	//上<br>	int i = 0;<br>	for (i = 0; i < 29; i++)<br>	{<br>		wprintf(L"%lc", WALL);<br>	}<br>	//下<br>	set_pos(0,25);<br>	for (i = 0; i < 29; i++)<br>	{<br>		wprintf(L"%lc", WALL);<br>	}<br>	//左<br>	for (i = 1; i < 25; i++)<br>	{<br>		set_pos(0, i);<br>		wprintf(L"%lc", WALL);<br>	}<br>	//右<br>	for (i = 1; i < 25; i++)<br>	{<br>		set_pos(56, i);<br>		wprintf(L"%lc", WALL);<br>	}<br>}</code></pre> <br><h4 id="%E7%84%B6%E5%90%8E%E6%88%91%E4%BB%AC%E5%B0%86%E8%B4%AA%E5%90%83%E8%9B%87%E5%88%9B%E5%BB%BA%E5%87%BA%E6%9D%A5%EF%BC%8C%E5%B0%86%E8%9B%87%E6%9C%89%E5%85%B3%E7%9A%84%E4%BF%A1%E6%81%AF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%B0%81%E8%A3%85%E8%B5%B7%E6%9D%A5%EF%BC%8C%E5%B0%86%E8%9B%87%E8%BA%AB%E7%94%A8%E9%93%BE%E8%A1%A8%E7%BB%B4%E6%8A%A4%E3%80%82">然后我们将贪吃蛇创建出来，将蛇有关的信息用结构体和枚举类型封装起来，将蛇身用链表维护。</h4> <br><p>蛇头指针：指向链表头节点的指针，方便对蛇身进行维护</p> <br><p>食物指针：从开发角度来说，其实食物也是蛇的一个节点，当蛇头的下一个位置为食物时，将食物的节点头插到蛇身上面。</p> <br><p>方向：对蛇的方向进行枚举</p> <br><p>游戏状态：方便判断蛇的状态：（1）正常（2）撞墙（3）撞到自己（4）正常退出每一次while循环后判断游戏状态</p> <br><p>食物权重：每次加速食物权重+2，减速-2。</p> <br><p>总成绩：每吃掉一个食物，蛇身长度+1，分数+=食物权重。</p> <br><p>每走一步的缓冲时间：缓冲时间越短，蛇走得越快；反之越慢。</p> <br><pre><code class="language-cpp">#define POS_X 24<br>#define POS_Y 5<br><br>#define WALL L'□'<br>#define BODY L'●'<br>#define FOOD L'★'<br>typedef struct SnakeNode<br>{<br>	//坐标<br>	int x;<br>	int y;<br>	//下一个节点<br>	struct SnakeNode* next;<br>}SnakeNode,*pSnakeNode;<br><br>enum DRECCTION//方向<br>{<br>	UP = 1,<br>	DOWN,<br>	LEFT,<br>	RIGHT<br>};<br><br>//蛇的状态<br>enum GAME_STATUS<br>{<br>	OK,//正常<br>	KILL_BY_WALL,//撞墙<br>	KILL_BY_SELF,//撞自己<br>	END_NORMAL//正常退出<br>};<br><br>typedef struct Snake<br>{<br>	pSnakeNode _pSnake;//指向蛇头的指针<br>	pSnakeNode _pFood;//指向食物节点的指针<br>	enum DRECCTION _dir;//蛇的方向<br>	enum GAME_STAYUS _status;//游戏状态<br>	int _food_weight;//一个食物都分数<br>	int _score;//总成绩<br>	int _sleep_time;//休息时间<br><br>}Snake,*pSnake;<br>/************************************/<br>void InitSnake(pSnake ps)//初始化蛇<br>{<br>	int i = 0;<br>	pSnakeNode cur = NULL;<br>	for (int i = 0; i < 5; i++)<br>	{<br>		cur = (pSnakeNode)malloc(sizeof(SnakeNode));<br>		if (cur == NULL)<br>		{<br>			perror("InitSnake()::malloc()");<br>			return;<br>		}<br>		cur->next = NULL;<br>		cur->x = POS_X + 2 * i;<br>		cur->y = POS_Y;<br>		//头插插入<br>		if (ps->_pSnake == NULL)<br>			ps->_pSnake = cur;<br>		else<br>		{<br>			cur->next = ps->_pSnake;<br>			ps->_pSnake = cur;<br>		}<br>	}<br>	cur = ps->_pSnake;<br>	while (cur)<br>	{<br>		set_pos(cur->x,cur->y);<br>		wprintf(L"%lc", BODY);<br>		cur = cur->next;<br>	}<br>	//设置蛇的属性<br>	ps->_dir = RIGHT;//默认<br>	ps->_score = 0;<br>	ps->_food_weight = 10;<br>	ps->_sleep_time = 200;//单位为ms<br>	ps->_status = OK;<br>}</code></pre> <br><h4 id="%E5%88%9B%E5%BB%BA%E9%A3%9F%E7%89%A9">创建食物</h4> <br><p>生成随机数，赋给x，y。</p> <br><p><span style="color:#fe2c24;">这里x和y都有范围，不能超出地图边界，并且不能与蛇身重合。</span></p> <br><pre><code class="language-cpp">void CreateFood(pSnake ps)//创建食物<br>{<br>	int x = 0;<br>	int y = 0;<br>again:<br>	do<br>	{<br>		x = rand() % 52 + 2;//2~54<br>		y = rand() % 24 + 1;//1~25<br>	} while (x % 2 != 0);//x为2的倍数<br>	//不能和蛇身的坐标相同<br>	pSnakeNode cur = ps->_pSnake;<br>	while (cur)<br>	{<br>		if (x == cur->x && y == cur->y)<br>			goto again;<br>		cur = cur->next;<br>	}<br>	//创建食物节点<br>	pSnakeNode pFood = (pSnakeNode)malloc(sizeof(SnakeNode));<br>	if (pFood == NULL)<br>	{<br>		perror("CreateFood()::malloc");<br>		return;<br>	}<br>	pFood->x = x;<br>	pFood->y = y;<br>	pFood->next = NULL;<br>	set_pos(x, y);<br>	wprintf(L"%lc", FOOD);<br>	ps->_pFood = pFood;<br>}</code></pre> <br><h3 id="%C2%A0%E6%B8%B8%E6%88%8F%E5%BC%80%E5%A7%8B%EF%BC%9A"> 游戏开始：</h3> <br><pre><code class="language-cpp"><br>void Game_Run(pSnake ps)//游戏运行逻辑<br>{<br>	//打印帮助信息<br>	PrintHelpInfo();<br>	do<br>	{<br>		//打印分数，食物权重<br>		set_pos(64, 8);<br>		printf("总分数:%d\n",ps->_score);<br>		set_pos(64, 9);<br>		printf("当前食物权重:%2d\n", ps->_food_weight);<br>		//按键检测<br>		if (KEY_PRESS(VK_UP) && ps->_dir != DOWN)<br>		{<br>			ps->_dir = UP;<br>		}<br>		else if (KEY_PRESS(VK_DOWN) && ps->_dir != UP)<br>		{<br>			ps->_dir = DOWN;<br>		}<br>		else if (KEY_PRESS(VK_LEFT) && ps->_dir != RIGHT)<br>		{<br>			ps->_dir = LEFT;<br>		}<br>		else if (KEY_PRESS(VK_RIGHT) && ps->_dir != LEFT)<br>		{<br>			ps->_dir = RIGHT;<br>		}<br>		else if (KEY_PRESS(VK_SPACE))<br>		{<br>			//暂停<br>			Pause();<br>		}<br>		else if (KEY_PRESS(VK_ESCAPE))<br>		{<br>			//正常退出<br>			ps->_status = END_NORMAL;<br>		}<br>		else if (KEY_PRESS(VK_OEM_6))<br>		{<br>			//加速<br>			if (ps->_sleep_time > 80)<br>			{<br>				ps->_sleep_time -= 30;<br>				ps->_food_weight += 2;<br>			}<br>		}<br>		else if (KEY_PRESS(VK_OEM_4))<br>		{<br>			//减速<br>			if (ps->_food_weight > 2)<br>			{<br>				ps->_sleep_time += 30;<br>				ps->_food_weight -= 2;<br>			}<br>		}<br><br>		SnakeMove(ps);//蛇走一步的过程<br>		Sleep(ps->_sleep_time);<br><br>	} while (ps->_status == OK);<br>}</code></pre> <br><h4 id="%E7%94%A8dowhile%E5%BE%AA%E7%8E%AF%E5%AF%B9%E4%B8%BB%E4%BD%93%E8%BF%9B%E8%A1%8C%E4%B8%8D%E6%96%AD%E5%88%B7%E6%96%B0">用dowhile循环对主体进行不断刷新</h4> <br><p>每次循环后让系统暂停一段时间（初始为200ms）</p> <br><h4 id="%E6%89%93%E5%8D%B0%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF">打印相关信息</h4> <br><p>蛇每走一步，分数都有可能变化，每次循环都打印一次。</p> <br><h4 id="%E6%8C%89%E9%94%AE%E6%A3%80%E6%B5%8B">按键检测</h4> <br><pre><code class="language-cpp">#define KEY_PRESS(vk) ((GetAsyncKeyState(vk)&1)?1:0)</code></pre> <br><p>（1）用虚拟键值检测是否按下上下左右键，按下相应键并且蛇的当前方向不能与之相反。</p> <br><p>（2）检测是否按下空格，按下就进函数：</p> <br><pre><code class="language-cpp">void Pause()<br>{<br>	while (1)<br>	{	<br>		Sleep(200);<br>		if (KEY_PRESS(VK_SPACE))<br>			break;<br>	}<br>}</code></pre> <br><p> 再次按下空格退出函数。</p> <br><p>（3）检测加速减速，按下加速键就将缓冲时间变短，食物权重增加；反之变长，食物权重减少。<span style="color:#fe2c24;">（这里也是有范围的，食物权重不能为负数，也不能过大）</span></p> <br><h4 id="%E8%9B%87%E7%9A%84%E7%A7%BB%E5%8A%A8">蛇的移动</h4> <br><p>进入函数，创建蛇头的下一个位置所在的节点，并根据方向算出所在位置。</p> <br><h5 id="%E5%88%A4%E6%96%AD%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E4%B8%BA%E9%A3%9F%E7%89%A9%EF%BC%9A">判断下一位置是否为食物：</h5> <br><pre><code class="language-cpp">bool NextIsFood(pSnakeNode pn, pSnake ps)//判断下一位置是否为食物<br>{<br>	return (ps->_pFood->x == pn->x && ps->_pFood->y == pn->y);<br>}</code></pre> <br><h5 id="%C2%A0%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E6%98%AF%E9%A3%9F%E7%89%A9%EF%BC%9A"> 下一位置是食物：</h5> <br><p>先将新节点头插进蛇身，打印蛇身在屏幕上，总分数加上食物权重。</p> <br><p>再次创建食物。</p> <br><pre><code class="language-cpp">void EatFood(pSnakeNode pn, pSnake ps)<br>{<br>	//头插<br>	ps->_pFood->next = ps->_pSnake;<br>	ps->_pSnake = ps->_pFood;<br><br>	//释放下一个位置的节点<br>	free(pn);<br>	pn = NULL;<br><br>	//打印<br>	pSnakeNode cur = ps->_pSnake;<br>	while (cur)<br>	{<br>		set_pos(cur->x, cur->y);<br>		wprintf(L"%lc",BODY);<br>		cur = cur->next;<br>	}<br>	ps->_score += ps->_food_weight;<br>	//重新创建食物<br>	CreateFood(ps);<br>}</code></pre> <br><h5 id="%E4%B8%8B%E4%B8%80%E4%BD%8D%E7%BD%AE%E4%B8%8D%E6%98%AF%E9%A3%9F%E7%89%A9%EF%BC%9A">下一位置不是食物：</h5> <br><p>创建下一位置的节点，也是头插，但是在打印蛇身之后，将蛇尾位置打印两个空格<span style="color:#fe2c24;">(不打印空格蛇身就不会清除一直留在屏幕上：拖尾)</span>，将蛇尾的节点释放掉。<span style="color:#fe2c24;">（cur->next一定要置空，不能让它为野指针）</span></p> <br><pre><code class="language-cpp">void NoFood(pSnakeNode pn, pSnake ps)//下一个位置不是食物<br>{<br>	//头插<br>	pn->next = ps->_pSnake;<br>	ps->_pSnake = pn;<br><br>	pSnakeNode cur = ps->_pSnake;<br>	while (cur->next->next)<br>	{<br>		set_pos(cur->x,cur->y);<br>		wprintf(L"%lc",BODY);<br><br>		cur = cur->next;<br>	}<br>	//把最后一个节点打印空格<br>	set_pos(cur->next->x,cur->next->y);<br>	printf("  ");<br>	//将最后一个节点释放<br>	free(cur->next);<br>	//将倒数第二个节点置为空<br>	cur->next = NULL;<br>}</code></pre> <br><h5 id="%C2%A0%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%92%9E%E5%A2%99%EF%BC%9A"> 检测是否撞墙：</h5> <br><p>判断蛇头坐标位置是否超出范围，若超出范围，将蛇的状态改为KILL_BY_WALL</p> <br><pre><code class="language-cpp">void KillByWall(pSnake ps)//检测撞墙<br>{<br>	if (ps->_pSnake->x == 0 || ps->_pSnake->x == 56 ||<br>		ps->_pSnake->y == 0 || ps->_pSnake->y == 26)<br>	{<br>		ps->_status = KILL_BY_WALL;<br>	}<br>}</code></pre> <br><h5 id="%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%92%9E%E5%88%B0%E8%87%AA%E5%B7%B1%EF%BC%9A">检测是否撞到自己：</h5> <br><p>遍历蛇身链表，若坐标重合，将蛇的状态改为KILL_BY_SELF，并且跳出循环。</p> <br><pre><code class="language-cpp">void KillBySelf(pSnake ps)//检测撞自己<br>{<br>	pSnakeNode cur = ps->_pSnake->next;<br>	while (cur)<br>	{<br>		if (cur->x == ps->_pSnake->x && cur->y == ps->_pSnake->y)<br>		{<br>			ps->_status = KILL_BY_SELF;<br>			break;<br>		}<br>		cur = cur->next;<br>	}<br>}</code></pre> <br><h5 id="%C2%A0%E8%9B%87%E7%A7%BB%E5%8A%A8%E4%B8%80%E6%AD%A5%E7%9A%84%E6%80%BB%E5%87%BD%E6%95%B0%EF%BC%9A"> 蛇移动一步的总函数：</h5> <br><pre><code class="language-cpp">void SnakeMove(pSnake ps)//蛇的移动<br>{<br>	//创建蛇头的下一个节点<br>	pSnakeNode pNextNode = (pSnakeNode)malloc(sizeof(SnakeNode));<br>	if (pNextNode == NULL)<br>	{<br>		perror("SnakeMove()::malloc()");<br>		return;<br>	}<br>	switch (ps->_dir)<br>	{<br>	case UP:<br>		pNextNode->x = ps->_pSnake->x;<br>		pNextNode->y = ps->_pSnake->y-1;<br>		break;<br>	case DOWN:<br>		pNextNode->x = ps->_pSnake->x;<br>		pNextNode->y = ps->_pSnake->y + 1;<br>		break;<br>	case LEFT:<br>		pNextNode->x = ps->_pSnake->x - 2;<br>		pNextNode->y = ps->_pSnake->y;<br>		break;<br>	case RIGHT:<br>		pNextNode->x = ps->_pSnake->x + 2;<br>		pNextNode->y = ps->_pSnake->y;<br>		break;<br>	}<br>	if (NextIsFood(pNextNode,ps))//检测下一个位置是否为食物<br>	{<br>		EatFood(pNextNode, ps);<br>	}<br>	else<br>	{<br>		NoFood(pNextNode, ps);<br>	}<br>	//检测是否撞墙<br>	KillByWall(ps);<br>	//检测是否撞自己<br>	KillBySelf(ps);<br>}</code></pre> <br><h3 id="%C2%A0%E6%B8%B8%E6%88%8F%E7%BB%93%E6%9D%9F%EF%BC%9A"> 游戏结束：</h3> <br><p>判断游戏结束的原因，并打印。</p> <br><p>释放蛇身链表</p> <br><pre><code class="language-cpp">void Game_End(pSnake ps)//游戏善后<br>{<br>	set_pos(24,12);<br>	switch (ps->_status)<br>	{<br>	case END_NORMAL:<br>		printf("您主动结束游戏\n");<br>		break;<br>	case KILL_BY_WALL:<br>		printf("您被墙单杀了\n");<br>		break;<br>	case KILL_BY_SELF:<br>		printf("您被自己单杀了\n");<br>		break;<br>	}<br><br>	//释放蛇身链表<br>	pSnakeNode cur = ps->_pSnake;<br>	while (cur)<br>	{<br>		pSnakeNode del = cur;<br>		cur = cur->next;<br>		free(del);<br>	}<br>}</code></pre> <br><h2 id="%E5%90%8E%E7%BB%AD%E6%94%B9%E8%BF%9B%EF%BC%9A">后续改进：</h2> <br><p>1.穿墙</p> <br><p>2.食物分类</p> <br><p>3.多个食物</p> <br><p>4.双人游戏</p> <br><p>……</p> <br><p style="text-align:center;"> <strong>本期博客到这里就结束了，如果有什么错误，欢迎指出，如果对你有帮助，请点个赞，谢谢！</strong></p>